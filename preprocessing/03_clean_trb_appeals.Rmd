---
title: "Tax Review Board Appeals"
author: "Nathaniel Olin"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

From Melissa André, data on TRB petitions.

* Effective Date is the date the petition was entered into the system
* NEW — it's new in the system either as a master or TRB case
* CBG - Continuance granted by the Board at the hearing
* CPG - Continuance requested by petitioner and granted
* CFG - Continuance; no further to be granted

```{r setup}
library(tidyverse)
theme_axes <- function(base_size = 11, base_family = ""){
  theme_bw(base_size = base_size, base_family = base_family) %+replace% 
    theme(panel.border = element_blank(),
          axis.line = element_line(colour = "black", size = 0.5), 
          legend.key = element_blank(), 
          strip.background = element_rect(fill = "gray90", color = 'white', size = 1),
          strip.placement = 'outside',
          complete = TRUE)
}
```

# Load data

```{r}
trb <- read_csv(file.path('..', 'data', 'raw', 'OOPA Cases-3_2018.csv'))
names(trb) <- names(trb) %>%
  tolower() %>%
  str_replace_all('[\\\\ ]', '_') %>%
  str_replace('\'', '')

names(trb)[names(trb) == 'account_number'] <- 'brt'
```

# Code new variables

Clean dates

```{r}
trb <- trb %>% mutate(effective = lubridate::mdy(effective),
                      hearing = lubridate::mdy(hearing))
```

Time from petition to hearing

```{r, warning = F}
trb$wait_time <- trb$hearing - trb$effective
# Correct negative wait-time value
trb$hearing[trb$wait_time < 0 & !is.na(trb$wait_time)]
trb$hearing[trb$wait_time < 0 & !is.na(trb$wait_time)] <- "2018-01-24"
# Recalculate
trb$wait_time <- trb$hearing - trb$effective
# Plot
ggplot(trb, aes(wait_time)) + 
  geom_histogram(binwidth = 30) + 
  geom_vline(xintercept = mean(trb$wait_time, na.rm = T), 
             linetype = 'dashed', size = 1) +
  theme_axes() + 
  scale_x_continuous() +
  scale_y_continuous(expand = c(0, 0)) +
  labs(x = 'Days from petition to hearing', y = 'Number of hearings')
```



* Effective Date is the date the petition was entered into the system
* NEW — it's new in the system either as a master or TRB case
* CBG - Continuance granted by the Board at the hearing
* CPG - Continuance requested by petitioner and granted
* CFG - Continuance; no further to be granted
* ADV - held under advisement; the Board wants additional info from the parties
* RPD - Rehearing petitioner denied – petitioner files a rehearing and it was denied
* RPG - rehearing petition granted - will be scheduled.

```{r}
trb %>% mutate(reason = recode(
  reason,
  NEW = 'Hearing pending',
  CBG = 'Continuance granted',
  CPG = 'Continuance granted',
  CFG = 'Continuance granted',
  ))
```

```{r}
oopa <- read_csv(file.path('..', 'oopa-notice-experiment', 'data', 'OOPA_report_clean.csv'))
```

